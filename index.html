<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Recettes détaillées avec FlexSearch</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 1rem; background: #fafafa; color: #222; }
    input[type="search"] {
      width: 100%; padding: 0.8rem; font-size: 1.1rem; margin-bottom: 1rem; border: 2px solid #4CAF50; border-radius: 5px;
    }
    ul {
      list-style: none; padding: 0; max-height: 70vh; overflow-y: auto; background: white; border: 1px solid #ccc; border-radius: 6px;
    }
    li {
      padding: 1rem; border-bottom: 1px solid #eee; white-space: pre-wrap; font-size: 0.9rem; line-height: 1.3;
    }
    .pagination {
      margin-top: 1rem; display: flex; justify-content: center; gap: 1rem;
    }
    button {
      padding: 0.5rem 1rem; font-size: 1rem; cursor: pointer; border-radius: 5px; border: 1px solid #4CAF50; background: #4CAF50; color: white;
    }
    button:disabled {
      background: #ccc; border-color: #ccc; cursor: not-allowed;
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/flexsearch@0.7.31/dist/flexsearch.bundle.js"></script>
</head>
<body>

  <h1>Recettes détaillées avec FlexSearch (10 000 recettes)</h1>
  <input type="search" id="searchInput" placeholder="Chercher titre, ingrédient, préparation..." autocomplete="off" />

  <ul id="recipeList"></ul>

  <div class="pagination">
    <button id="prevBtn" disabled>Précédent</button>
    <span id="pageInfo">Page 1</span>
    <button id="nextBtn" disabled>Suivant</button>
  </div>

  <script>
    const totalRecipes = 10000;
    const pageSize = 50;
    let currentPage = 1;
    let results = [];

    // Données de base
    const baseTitles = [
      "Soupe aux légumes",
      "Salade fraîche",
      "Poulet rôti",
      "Tarte aux pommes",
      "Gratin dauphinois",
      "Omelette au fromage",
      "Pâtes à la bolognaise",
      "Poisson grillé",
      "Crêpes sucrées",
      "Gâteau au yaourt"
    ];

    const baseIngredients = [
      "légumes frais, huile d'olive, sel, poivre",
      "salade verte, tomates, vinaigrette, herbes",
      "poulet entier, herbes de Provence, ail, huile",
      "pommes, pâte brisée, sucre, cannelle",
      "pommes de terre, crème, ail, fromage",
      "œufs, fromage râpé, beurre, sel",
      "pâtes, viande hachée, tomates, oignons",
      "filet de poisson, citron, herbes, huile",
      "farine, œufs, lait, sucre",
      "yaourt, farine, œufs, sucre"
    ];

    const basePreparations = [
      "Mélangez les ingrédients et faites cuire doucement.",
      "Coupez, assaisonnez, et servez frais.",
      "Assaisonnez et faites rôtir au four pendant 1 heure.",
      "Disposez les fruits sur la pâte et enfournez 40 minutes.",
      "Coupez en tranches, nappez de crème, et faites gratiner.",
      "Battez les œufs avec le fromage, cuisez à la poêle.",
      "Préparez la sauce avec viande et tomates, servez avec pâtes.",
      "Assaisonnez, puis grillez à la poêle ou au four.",
      "Préparez la pâte, cuisez des crêpes fines et dorées.",
      "Mélangez tout, versez dans un moule et enfournez."
    ];

    // Générer les recettes
    const data = [];
    for(let i=0; i<totalRecipes; i++) {
      const idx = i % baseTitles.length;
      data.push({
        id: i,
        title: `${baseTitles[idx]} n°${i+1}`,
        ingredients: baseIngredients[idx],
        preparation: basePreparations[idx]
      });
    }

    // Création d'un index FlexSearch multi-champs
    const index = new FlexSearch.Document({
      document: {
        id: "id",
        index: ["title", "ingredients", "preparation"],
        store: ["title", "ingredients", "preparation"]
      },
      tokenize: "forward",
      cache: true,
      resolution: 3
    });

    // Indexation
    data.forEach(item => index.add(item));

    const list = document.getElementById("recipeList");
    const input = document.getElementById("searchInput");
    const prevBtn = document.getElementById("prevBtn");
    const nextBtn = document.getElementById("nextBtn");
    const pageInfo = document.getElementById("pageInfo");

    function renderPage(page) {
      list.innerHTML = "";
      const start = (page - 1) * pageSize;
      const end = start + pageSize;
      const pageItems = results.slice(start, end);

      if(pageItems.length === 0) {
        const li = document.createElement("li");
        li.textContent = "Aucune recette trouvée.";
        list.appendChild(li);
      } else {
        for(const item of pageItems) {
          const li = document.createElement("li");
          li.textContent = `${item.title}\nIngrédients : ${item.ingredients}\nPréparation : ${item.preparation}`;
          list.appendChild(li);
        }
      }

      const totalPages = Math.max(1, Math.ceil(results.length / pageSize));
      pageInfo.textContent = `Page ${page} / ${totalPages}`;
      prevBtn.disabled = page <= 1;
      nextBtn.disabled = page >= totalPages;
    }

    async function doSearch(query) {
      if(!query) {
        results = data;
      } else {
        const foundIds = await index.searchAsync(query, { enrich: true });
        // foundIds est tableau d'objets { result: [ids] } par champ, on fusionne et unique
        const allIds = new Set();
        foundIds.forEach(res => {
          res.result.forEach(id => allIds.add(id));
        });
        results = Array.from(allIds).map(id => data[id]);
      }
      currentPage = 1;
      renderPage(currentPage);
    }

    input.addEventListener("input", e => {
      doSearch(e.target.value.trim());
    });

    prevBtn.addEventListener("click", () => {
      if(currentPage > 1) {
        currentPage--;
        renderPage(currentPage);
      }
    });

    nextBtn.addEventListener("click", () => {
      const totalPages = Math.ceil(results.length / pageSize);
      if(currentPage < totalPages) {
        currentPage++;
        renderPage(currentPage);
      }
    });

    // Affichage initial
    doSearch("");
  </script>

</body>
</html>
